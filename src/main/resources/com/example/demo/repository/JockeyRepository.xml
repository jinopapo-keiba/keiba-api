<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.repository.JockeyRepository">
    <select id="fetchJockey" resultType="com.example.demo.entity.Jockey">
        SELECT name,id from jockey where id = #{id};
    </select>
    <select id="fetchJockeys" resultType="com.example.demo.entity.Jockey">
        SELECT name,id from jockey where name in
        <foreach item="name" collection="names" open="(" separator="," close=")">
            #{name}
        </foreach>
    </select>
    <select id="fetchJockeyRanking" resultType="Float">
        SELECT avg(ranking)
        FROM race
        JOIN raceResult ON race.id = raceResult.raceId
        JOIN raceHorse ON race.id = raceHorse.raceId AND raceResult.frameNumber = raceHorse.frameNumber
        join jockey on jockey.id = raceHorse.jockeyId
        where jockey.id = #{id} AND stadium = #{stadium} AND raceLength = #{raceLength} AND raceType = #{raceType}
        group by jockeyId,stadium,raceLength
        having count(ranking) > 10;
    </select>
    <insert id="saveJockey" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO jockey (name) VALUES (#{jockey.name})
    </insert>
</mapper>
